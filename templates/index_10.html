<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>落研 - スレッド一覧</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>落研 掲示板</h1>
        
        <div class="header-links">
            {% if current_user.is_authenticated %}
                <p>ようこそ、{{ current_user.username }}さん！</p>
                <a href="{{ url_for('logout') }}" class="button">ログアウト</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="button">ログイン</a>
                <a href="{{ url_for('register') }}" class="button">新規登録</a>
            {% endif %}
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                    {% for category, message in messages %}
                        <li class="{{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <hr>
        
        {# スレッド作成ボタン #}
        {% if current_user.is_authenticated %}
            <div class="create-thread-section">
                <a href="{{ url_for('create_thread_form') }}" class="button primary">
                    新しいスレッドを立てる
                </a>
            </div>
        {% else %}
            <p>スレッドを立てるには<a href="{{ url_for('login') }}">ログイン</a>してください。</p>
        {% endif %}

        <hr>

        <h2>スレッド一覧</h2>

        {# スレッド一覧の表示 #}
        {% if threads %}
            <div class="thread-list">
                {% for thread in threads %}
                    <div class="thread-item">
                        <h3 class="thread-title">
                            <a href="{{ url_for('thread_detail', thread_id=thread.id) }}">{{ thread.title }}</a>
                        </h3>
                        <p class="thread-meta">
                            作成者: <strong>{{ thread.author.username }}</strong>
                            | 作成日時: {{ thread.created_at.strftime('%Y-%m-%d %H:%M') }}
                            | 投稿数: {{ thread.posts.count() }}
                        </p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-threads">まだスレッドがありません。</p>
        {% endif %}

    </div>
</body>
</html>